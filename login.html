<?php
session_start();

$errors = [];

if ($_SERVER["REQUEST_METHOD"] === "POST") {
    // Trim inputs
    $username = trim($_POST["username"] ?? '');
    $password = trim($_POST["password"] ?? '');

    // Username validation
    if ($username === '') {
        $errors[] = "Username is required.";
    } elseif (!preg_match('/^[A-Za-z0-9_]{3,20}$/', $username)) {
        $errors[] = "Username must be 3â€“20 letters, numbers, or underscores.";
    }

    // Password validation
    if ($password === '') {
        $errors[] = "Password is required.";
    } elseif (strlen($password) < 6) {
        $errors[] = "Password must be at least 6 characters.";
    } elseif (!preg_match('/[0-9]/', $password)) {
        $errors[] = "Password must include at least one number.";
    }

    // Redirect only if no errors
    if (empty($errors)) {
        $_SESSION["loggedin"] = true;
        header("Location: body.php");
        exit;
    }
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>
<style>
    body {
        background:#f5f7fa;
        font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;
        display:flex;
        justify-content:center;
        align-items:center;
        height:100vh;
    }
    .login-box {
        background:white;
        padding:30px;
        border-radius:8px;
        box-shadow:0 4px 15px rgba(0,0,0,0.1);
        width:320px;
    }
    h2 { text-align:center; margin-bottom:20px; }
    input[type=text], input[type=password] {
        width:100%;
        padding:10px;
        margin:10px 0;
        border:1px solid #ccc;
        border-radius:5px;
    }
    button {
        width:100%;
        padding:10px;
        background:#6a11cb;
        color:white;
        border:none;
        border-radius:5px;
        cursor:pointer;
    }
    button:hover { background:#5a0db3; }
    .error {
        color:red;
        margin-bottom:10px;
        font-size:0.9rem;
    }
</style>
</head>
<body>
<div class="login-box">
    <h2>Login</h2>
    <?php if (!empty($errors)): ?>
        <div class="error">
            <?php foreach ($errors as $e): ?>
                <?php echo htmlspecialchars($e) . "<br>"; ?>
            <?php endforeach; ?>
        </div>
    <?php endif; ?>
    <form method="post" action="">
        <input type="text" name="username" placeholder="Username" 
               value="<?php echo htmlspecialchars($_POST['username'] ?? '') ?>">
        <input type="password" name="password" placeholder="Password">
        <button type="submit">Login</button>
    </form>
</div>
</body>
</html>
